!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Mortice={})}(this,(function(e){var t,n,r,i,o,s,u,a,c,l,h,f,p,d,v,_,y,m,g,w,E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function L(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}function b(){b.init.call(this)}function C(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function O(e){return void 0===e._maxListeners?b.defaultMaxListeners:e._maxListeners}function T(e,t,n,r){var i,o,s,u,a;return C(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s?(s=o[t]=n,++e._eventsCount):("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=O(e))>0&&s.length>i&&!s.warned&&(s.warned=!0,(u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a))),e}function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=R.bind(r);return i.listener=n,r.wrapFn=i,i}function I(e,t,n){var r,i=e._events;return void 0===i||void 0===(r=i[t])?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;t.length>n;++n)t[n]=e[n].listener||e[n];return t}(r):k(r,r.length)}function P(e){var t,n=this._events;if(void 0!==n){if("function"==typeof(t=n[e]))return 1;if(void 0!==t)return t.length}return 0}function k(e,t){var n,r=new Array(t);for(n=0;t>n;++n)r[n]=e[n];return r}function A(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}t={},n={exports:{}},r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},o=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||function(e){return e!=e},n.exports=b,n.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}A(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&A(e,"error",t,n)}(e,i,{once:!0})}))},b.EventEmitter=b,b.prototype._events=void 0,b.prototype._eventsCount=0,b.prototype._maxListeners=void 0,u=10,Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||0>e||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),b.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},b.prototype.getMaxListeners=function(){return O(this)},b.prototype.emit=function(e){var t,n,r,o,s,u,a,c,l=[];for(t=1;arguments.length>t;t++)l.push(arguments[t]);if(n="error"===e,void 0!==(r=this._events))n=n&&void 0===r.error;else if(!n)return!1;if(n){if(l.length>0&&(o=l[0]),o instanceof Error)throw o;throw(s=new Error("Unhandled error."+(o?" ("+o.message+")":""))).context=o,s}if(void 0===(u=r[e]))return!1;if("function"==typeof u)i(u,this,l);else for(c=k(u,a=u.length),t=0;a>t;++t)i(c[t],this,l);return!0},b.prototype.on=b.prototype.addListener=function(e,t){return T(this,e,t,!1)},b.prototype.prependListener=function(e,t){return T(this,e,t,!0)},b.prototype.once=function(e,t){return C(t),this.on(e,x(this,e,t)),this},b.prototype.prependOnceListener=function(e,t){return C(t),this.prependListener(e,x(this,e,t)),this},b.prototype.off=b.prototype.removeListener=function(e,t){var n,r,i,o,s;if(C(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(0>i)return this;0===i?n.shift():function(e,t){for(;e.length>t+1;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},b.prototype.removeAllListeners=function(e){var t,n,r,i,o=this._events;if(void 0===o)return this;if(void 0===o.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==o[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete o[e]),this;if(0===arguments.length){for(r=Object.keys(o),n=0;r.length>n;++n)"removeListener"!==(i=r[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=o[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},b.prototype.listeners=function(e){return I(this,e,!0)},b.prototype.rawListeners=function(e){return I(this,e,!1)},b.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):P.call(e,t)},b.prototype.listenerCount=P,b.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};let j=e=>crypto.getRandomValues(new Uint8Array(e)),q=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*r*t/e.length);return()=>{let o="";for(;;){let s=n(i),u=i;for(;u--;)if(o+=e[s[u]&r]||"",o.length===t)return o}}};a=L(Object.freeze({__proto__:null,nanoid:(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=36>r?r.toString(36):62>r?(r-26).toString(36).toUpperCase():63>r?"_":"-"}return t},customAlphabet:(e,t)=>q(e,t,j),customRandom:q,urlAlphabet:"ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",random:j})),c={WORKER_REQUEST_READ_LOCK:"lock:worker:request-read",WORKER_RELEASE_READ_LOCK:"lock:worker:release-read",MASTER_GRANT_READ_LOCK:"lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK:"lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK:"lock:worker:release-write",MASTER_GRANT_WRITE_LOCK:"lock:master:grant-write"};const S={},W=e=>{e.addEventListener("message",(t=>{W.dispatchEvent("message",e,t)})),e.port&&e.port.addEventListener("message",(t=>{W.dispatchEvent("message",e,t)}))};W.addEventListener=(e,t)=>{S[e]||(S[e]=[]),S[e].push(t)},W.removeEventListener=(e,t)=>{S[e]&&(S[e]=S[e].filter((e=>e===t)))},W.dispatchEvent=function(){const e=Array.prototype.slice.call(arguments),t=e.shift();S[t]&&S[t].forEach((t=>t.apply(null,e)))},l=W;const M=n.exports.EventEmitter,{nanoid:K}=a,{WORKER_REQUEST_READ_LOCK:N,WORKER_RELEASE_READ_LOCK:z,MASTER_GRANT_READ_LOCK:D,WORKER_REQUEST_WRITE_LOCK:U,WORKER_RELEASE_WRITE_LOCK:Q,MASTER_GRANT_WRITE_LOCK:F}=c,$=l,G=(e,t,n,r,i)=>(o,s)=>{if(!s||!s.data||s.data.type!==n)return;const u={type:s.data.type,name:s.data.name,identifier:s.data.identifier};e.emit(t,u.name,(()=>(o.postMessage({type:i,name:u.name,identifier:u.identifier}),new Promise((e=>{const t=n=>{if(!n||!n.data)return;const i={type:n.data.type,name:n.data.name,identifier:n.data.identifier};i&&i.type===r&&i.identifier===u.identifier&&(o.removeEventListener("message",t),e())};o.addEventListener("message",t)})))))},V=(e,t,n,r)=>()=>{const i=K();return globalThis.postMessage({type:t,identifier:i,name:e}),new Promise((t=>{const o=s=>{if(!s||!s.data)return;const u={type:s.data.type,identifier:s.data.identifier};u&&u.type===n&&u.identifier===i&&(globalThis.removeEventListener("message",o),t((()=>{globalThis.postMessage({type:r,identifier:i,name:e})})))};globalThis.addEventListener("message",o)}))},B={singleProcess:!1};h=e=>{e=Object.assign({},B,e);if(!!globalThis.document||e.singleProcess){const e=new M;return $.addEventListener("message",G(e,"requestReadLock",N,z,D)),$.addEventListener("message",G(e,"requestWriteLock",U,Q,F)),e}return{isWorker:!0,readLock:e=>V(e,N,D,z),writeLock:e=>V(e,U,F,Q)}},f={},function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var u=new i(r,o||e,s),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],u]:e._events[a].push(u):(e._events[a]=u,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},u.prototype.listeners=function(e){var t,r,i,o=n?n+e:e,s=this._events[o];if(!s)return[];if(s.fn)return[s.fn];for(t=0,r=s.length,i=new Array(r);r>t;t++)i[t]=s[t].fn;return i},u.prototype.listenerCount=function(e){var t=this._events[n?n+e:e];return t?t.fn?1:t.length:0},u.prototype.emit=function(e,t,r,i,o,s){var u,a,c,l,h,f,p=n?n+e:e;if(!this._events[p])return!1;if(a=arguments.length,(u=this._events[p]).fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),a){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,s),!0}for(l=1,c=new Array(a-1);a>l;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else for(h=u.length,l=0;h>l;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),a){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!c)for(f=1,c=new Array(a-1);a>f;f++)c[f-1]=arguments[f];u[l].fn.apply(u[l].context,c)}return!0},u.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,r,i){var o,u,a,c,l=n?n+e:e;if(!this._events[l])return this;if(!t)return s(this,l),this;if((o=this._events[l]).fn)o.fn!==t||i&&!o.once||r&&o.context!==r||s(this,l);else{for(u=0,a=[],c=o.length;c>u;u++)(o[u].fn!==t||i&&!o[u].once||r&&o[u].context!==r)&&a.push(o[u]);a.length?this._events[l]=1===a.length?a[0]:a:s(this,l)}return this},u.prototype.removeAllListeners=function(e){var t;return e?this._events[t=n?n+e:e]&&s(this,t):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,e.exports=u}(p={exports:{}}),d={exports:{}};const H=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))));class J extends Error{constructor(e){super(e),this.name="TimeoutError"}}const X=(e,t,n)=>new Promise(((r,i)=>{if("number"!=typeof t||0>t)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void r(e);const o=setTimeout((()=>{if("function"==typeof n){try{r(n())}catch(e){i(e)}return}const o=n instanceof Error?n:new J("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(o)}),t);H(e.then(r,i),(()=>{clearTimeout(o)}))}));d.exports=X,d.exports.default=X,d.exports.TimeoutError=J,v={},_={},Object.defineProperty(_,"__esModule",{value:!0}),_.default=function(e,t,n){let r=0,i=e.length;for(;i>0;){const o=i/2|0;let s=r+o;n(e[s],t)>0?i=o:(r=++s,i-=o+1)}return r},Object.defineProperty(v,"__esModule",{value:!0});const Y=_;v.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const r=Y.default(this._queue,n,((e,t)=>t.priority-e.priority));this._queue.splice(r,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}},Object.defineProperty(f,"__esModule",{value:!0});const Z=p.exports,ee=d.exports,te=v,ne=()=>{},re=new ee.TimeoutError;f.default=class extends Z{constructor(e){var t,n,r,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=ne,this._resolveIdle=ne,"number"!=typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:te.default},e)).intervalCap||1>e.intervalCap)throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!Number.isFinite(e.interval)||0>e.interval)throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCap>this._intervalCount}get _doesConcurrentAllowAnother(){return this._concurrency>this._pendingCount}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=ne,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=ne,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(t>=0)return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if("number"!=typeof e||1>e)throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((n,r)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():ee.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(re)}));n(await i)}catch(e){r(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}},(y={}).timeout=function(e,t){var n,r=new m;return Promise.race([e,new Promise((function(e,i){n=setTimeout((function(){i(r)}),t)}))]).then((function(e){return clearTimeout(n),e}),(function(e){throw clearTimeout(n),e}))},(m=y.TimeoutError=function(){Error.call(this),this.stack=Error().stack,this.message="Timeout"}).prototype=Object.create(Error.prototype),m.prototype.name="TimeoutError";const ie=h,{default:oe}=f,{timeout:se}=y,ue=l,ae={};let ce;function le(e,t){let n;const r=new Promise((e=>{n=e}));return e.add((()=>se(new Promise((e=>{n((()=>{e()}))})),t.timeout))),r}const he={concurrency:1/0,timeout:846e5,global:E,singleProcess:!1};g=t.Lock=(e,t)=>(t||(t={}),"object"==typeof e&&(t=e,e="lock"),e||(e="lock"),t=Object.assign({},he,t),ce||(ce=ie(t),ce.isWorker||(ce.on("requestReadLock",((e,t)=>{ae[e]&&ae[e].readLock().then((e=>t().finally((()=>e()))))})),ce.on("requestWriteLock",(async(e,t)=>{ae[e]&&ae[e].writeLock().then((e=>t().finally((()=>e()))))})))),ae[e]||(ae[e]=((e,t)=>{if(ce.isWorker)return{readLock:ce.readLock(e,t),writeLock:ce.writeLock(e,t)};const n=new oe({concurrency:1});let r=null;return{readLock:()=>{if(r)return le(r,t);r=new oe({concurrency:t.concurrency,autoStart:!1});const e=r,i=le(r,t);return n.add((()=>(e.start(),e.onIdle().then((()=>{r===e&&(r=null)}))))),i},writeLock:()=>(r=null,le(n,t))}})(e,t)),ae[e]),w=t.Worker=function(e,t){let n;t=t||E.Worker;try{n=new t(e)}catch(r){r.message.includes("not a constructor")&&(n=t(e))}if(!n)throw new Error("Could not create Worker from",t);return ue(n),n},e.Lock=g,e.Worker=w,e.default=t,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=mortice.2.0.1.min.js.map
